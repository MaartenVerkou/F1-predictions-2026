<%- include('partials/header', { title: 'Dashboard', user }) %>

<section class="hero">
  <% if (error) { %>
    <div class="alert"><%= error %></div>
  <% } %>
  <% if (success) { %>
    <div class="alert" style="background:#eef8f0;border-color:#c8e6d0;color:#2d6a3a;"><%= success %></div>
  <% } %>

  <div class="card">
    <div class="inline-actions" style="justify-content: space-between;">
      <h1 style="margin:0 0 12px 0;">My groups</h1>
      <div class="inline-actions">
        <a class="button-link" href="#create-group">Create group</a>
        <a class="link" href="#join-group">Join group</a>
      </div>
    </div>
    <% if (groups.length === 0) { %>
      <p class="muted">No groups yet. Create one below.</p>
    <% } %>
    <ul class="list">
      <% groups.forEach(group => { %>
        <li class="card" style="padding:16px;">
          <div class="inline-actions" style="justify-content: space-between;">
            <div>
              <strong><%= group.name %></strong>
              <span class="muted">(<%= group.role %>)</span>
            </div>
            <a class="link" href="/groups/<%= group.id %>">View group</a>
          </div>
        </li>
      <% }) %>
    </ul>
  </div>

  <div class="card" id="create-group">
    <h2>Create a new group</h2>
    <form method="post" action="/groups">
      <label>
        Group name
        <input type="text" name="name" required />
      </label>
      <label>
        Visibility
        <select name="visibility" required>
          <option value="private">Private (invite code + password)</option>
          <option value="public">Public (anyone can join)</option>
        </select>
      </label>
      <label>
        Group password (required for private groups)
        <input type="password" name="joinPassword" minlength="4" />
      </label>
      <button type="submit">Create group</button>
    </form>
  </div>

  <div class="card" id="public-groups">
    <h2>Public groups</h2>
    <% if (!publicGroups || publicGroups.length === 0) { %>
      <p class="muted">No public groups available.</p>
    <% } else { %>
      <ul class="list">
        <% publicGroups.forEach(group => { %>
          <li class="card" style="padding:12px;">
            <div class="inline-actions" style="justify-content: space-between;">
              <div>
                <strong><%= group.name %></strong>
                <span class="muted">(owner: <%= group.owner_name %>)</span>
              </div>
              <form method="post" action="/groups/<%= group.id %>/join-public" style="margin:0;">
                <button type="submit">Join</button>
              </form>
            </div>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>

  <div class="card" id="join-group">
    <h2>Private groups</h2>
    <p class="muted">Join with code + password. Private groups are not listed publicly.</p>
    <form method="post" action="/groups/join">
      <label>
        Group code
        <input type="text" name="code" required />
      </label>
      <label>
        Group password
        <input type="password" name="password" required />
      </label>
      <button type="submit">Join group</button>
    </form>
  </div>
</section>

<%- include('partials/footer') %>
