<%- include('partials/header', { title: t('dashboard.page_title'), user }) %>

<section class="hero">
  <% if (error) { %>
    <div class="alert"><%= error %></div>
  <% } %>
  <% if (success) { %>
    <div class="alert" style="background:#eef8f0;border-color:#c8e6d0;color:#2d6a3a;"><%= success %></div>
  <% } %>

  <div class="card">
    <div class="inline-actions" style="justify-content: space-between; align-items: flex-start;">
      <h1 style="margin:0 0 12px 0;"><%= t('dashboard.my_groups') %></h1>
      <div class="inline-actions">
        <a class="button-link" href="#create-group"><%= t('dashboard.create_group') %></a>
      </div>
    </div>
    <% if (groups.length === 0) { %>
      <p class="muted"><%= t('dashboard.no_groups') %></p>
    <% } %>
    <ul class="list">
      <% groups.forEach(group => { %>
        <li class="card dashboard-group-item">
          <a class="dashboard-group-link" href="/groups/<%= group.id %>" aria-label="<%= `${t('dashboard.view_group')}: ${group.name}` %>">
            <div class="inline-actions" style="justify-content: space-between;">
              <div>
                <strong><%= group.name %></strong>
                <span class="muted">(<%= group.role %>)</span>
              </div>
              <span class="dashboard-group-view-label"><%= t('dashboard.view_group') %></span>
            </div>
          </a>
        </li>
      <% }) %>
    </ul>
  </div>

  <div class="card" id="public-groups">
    <h2><%= t('dashboard.public_groups') %></h2>
    <% if (!publicGroups || publicGroups.length === 0) { %>
      <p class="muted"><%= t('dashboard.no_public_groups') %></p>
    <% } else { %>
      <ul class="list">
        <% publicGroups.forEach(group => { %>
          <li class="card" style="padding:12px;">
            <div class="inline-actions" style="justify-content: space-between;">
              <div>
                <strong><%= group.name %></strong>
                <span class="muted">(<%= t('dashboard.owner') %>: <%= group.owner_name %>)</span>
                <% if (group.is_global) { %>
                  <span class="muted"> - <%= t('dashboard.global_group_free') %></span>
                <% } %>
              </div>
              <form method="post" action="/groups/<%= group.id %>/join-public" style="margin:0;">
                <button type="submit"><%= group.is_global ? t('dashboard.join_free') : t('dashboard.join') %></button>
              </form>
            </div>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>

  <div class="card" id="join-group">
    <h2><%= t('dashboard.private_groups') %></h2>
    <p class="muted"><%= t('dashboard.private_groups_help') %></p>
    <form method="post" action="/groups/join">
      <label>
        <%= t('dashboard.group_code') %>
        <input type="text" name="code" required />
      </label>
      <label>
        <%= t('dashboard.group_password') %>
        <input type="password" name="password" required />
      </label>
      <button type="submit"><%= t('dashboard.join_group') %></button>
    </form>
  </div>

  <div class="card" id="create-group">
    <h2><%= t('dashboard.create_new_group') %></h2>
    <form method="post" action="/groups">
      <label>
        <%= t('dashboard.group_name') %>
        <input
          type="text"
          name="name"
          required
          data-name-check-url="/api/groups/check-name"
          data-name-check-delay="2000"
          data-name-check-min-length="2"
          data-name-check-msg-checking="Checking group name..."
          data-name-check-msg-available="Group name is available."
          data-name-check-msg-taken="Group name already exists."
          data-name-check-msg-error="Could not check group name right now."
        />
        <span class="field-status muted" data-name-check-feedback aria-live="polite"></span>
      </label>
      <label>
        <%= t('dashboard.visibility') %>
        <select name="visibility" required>
          <option value="private"><%= t('dashboard.private_option') %></option>
          <option value="public"><%= t('dashboard.public_option') %></option>
        </select>
      </label>
      <label>
        <%= t('dashboard.group_password_private') %>
        <input type="password" name="joinPassword" minlength="4" />
      </label>
      <button type="submit"><%= t('dashboard.create_group') %></button>
    </form>
  </div>
</section>

<%- include('partials/footer') %>
