<%- include('partials/header', { title: 'Admin analysis', user }) %>
<%- include('partials/admin_nav', { active: 'analysis' }) %>

<div class="card">
  <h1>Admin analysis</h1>
  <p class="muted">Create simulation groups and manage existing test groups.</p>
  <% if (adminError) { %>
    <div class="alert"><%= adminError %></div>
  <% } %>
  <% if (adminSuccess) { %>
    <p class="muted"><%= adminSuccess %></p>
  <% } %>

  <h2>Create test group</h2>
  <form method="post" action="/admin/test-group" class="inline-actions" style="align-items:flex-end; margin: 0 0 20px;">
    <label class="muted" style="display:flex; flex-direction:column; gap:6px; min-width:260px;">
      Group name
      <input type="text" name="groupName" placeholder="Test Group Sprint 1" />
    </label>
    <label class="muted" style="display:flex; flex-direction:column; gap:6px; width:180px;">
      Fake players
      <input type="number" name="fakePlayerCount" min="1" max="5000" value="200" required />
    </label>
    <button type="submit">Create test group</button>
  </form>

  <h2>Test groups</h2>
  <% if (groups.length === 0) { %>
    <p class="muted">No test groups yet.</p>
  <% } else { %>
    <table class="table compact admin-analysis-groups-table">
      <thead>
        <tr>
          <th>Group</th>
          <th>Owner</th>
          <th>Total members</th>
          <th>Created</th>
          <th>Actions</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        <% groups.forEach(row => { %>
          <tr>
            <td><%= row.name %></td>
            <td><%= row.owner_name %></td>
            <td><%= Number(row.total_members || 0) %></td>
            <td><%= new Date(row.created_at).toLocaleString() %></td>
            <td>
              <div class="table-actions">
                <a class="link" href="/admin/analysis/<%= row.id %>?mode=actuals">Analyze actuals</a>
                <a class="link" href="/admin/analysis/<%= row.id %>?mode=sim200">Analyze 200 seasons</a>
              </div>
            </td>
            <td>
              <form method="post" action="/admin/groups/<%= row.id %>/delete?from=analysis" onsubmit="return confirm('Delete this test group and all related data?')">
                <button class="secondary no-wrap-btn" type="submit">Delete group</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>

  <div class="inline-actions" style="margin-top: 10px;">
    <% if (currentPage > 1) { %>
      <a class="link" href="/admin/analysis?page=<%= currentPage - 1 %>">Previous <%= groupsPerPage %></a>
    <% } %>
    <span class="muted">Page <%= currentPage %> of <%= totalPages %></span>
    <% if (currentPage < totalPages) { %>
      <a class="link" href="/admin/analysis?page=<%= currentPage + 1 %>">Next <%= groupsPerPage %></a>
    <% } %>
  </div>
</div>

<%- include('partials/footer') %>
