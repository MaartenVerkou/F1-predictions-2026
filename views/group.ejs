<%- include('partials/header', { title: group.name, user }) %>

<section class="hero">
  <div class="card">
    <h1><%= group.name %></h1>
    <p class="muted">Invite friends, then head to the questions page to lock in picks.</p>
    <p class="muted">Group closes on March 5, 2026.</p>
    <p class="muted">Group code: <strong><%= group.join_code || 'Not set yet' %></strong></p>
    <div class="inline-actions">
      <a class="button-link" href="/groups/<%= group.id %>/questions">Answer questions</a>
      <a class="link" href="/groups/<%= group.id %>/responses">View responses</a>
      <a class="link" href="/groups/<%= group.id %>/leaderboard">Leaderboard</a>
      <form method="post" action="/groups/<%= group.id %>/leave" onsubmit="return confirm('Leave this group?');" style="margin:0;">
        <button class="secondary" type="submit">Leave group</button>
      </form>
    </div>
  </div>

  <div class="card">
    <h2>Invite link</h2>
    <% if (invite) { %>
      <div class="card" style="padding:12px;">
        <div class="inline-actions" style="justify-content: space-between;">
          <span class="link" id="invite-link">/join/<%= invite.code %></span>
          <button type="button" class="secondary" data-copy-target="invite-link">Copy</button>
        </div>
        <div class="muted">Created <%= new Date(invite.created_at).toLocaleString() %></div>
      </div>
    <% } else { %>
      <p class="muted">No invite link yet.</p>
    <% } %>

    <% if (role === 'owner' || role === 'admin') { %>
      <div class="inline-actions" style="margin-top:12px;">
        <form method="post" action="/groups/<%= group.id %>/invites">
          <button type="submit">Generate new link</button>
        </form>
        <form method="post" action="/groups/<%= group.id %>/invites/remove">
          <button class="secondary" type="submit">Remove link</button>
        </form>
      </div>
    <% } %>
  </div>

  <div class="card">
    <h2>Members</h2>
    <ul class="list">
      <% members.forEach(member => { %>
        <li>
          <strong><%= member.name %></strong>
          <span class="muted">(<%= member.role %>)</span>
          <% if (role === 'owner' || role === 'admin') { %>
            <% if (member.role !== 'owner') { %>
              <form method="post" action="/groups/<%= group.id %>/members/<%= member.id %>/kick" style="display:inline;">
                <button class="secondary" type="submit">Kick</button>
              </form>
            <% } %>
            <% if (member.role === 'member') { %>
              <form method="post" action="/groups/<%= group.id %>/members/<%= member.id %>/promote" style="display:inline;">
                <button class="secondary" type="submit">Make admin</button>
              </form>
            <% } %>
            <% if (member.role === 'admin') { %>
              <form method="post" action="/groups/<%= group.id %>/members/<%= member.id %>/demote" style="display:inline;">
                <button class="secondary" type="submit">Remove admin</button>
              </form>
            <% } %>
          <% } %>
        </li>
      <% }) %>
    </ul>
  </div>

  <% if (role === 'owner' || role === 'admin') { %>
    <div class="card">
      <h2>Group password</h2>
      <form method="post" action="/groups/<%= group.id %>/password">
        <label>
          Set new password
          <input type="password" name="joinPassword" required minlength="4" />
        </label>
        <button type="submit">Update password</button>
      </form>
    </div>
  <% } %>
</section>

<%- include('partials/footer') %>
